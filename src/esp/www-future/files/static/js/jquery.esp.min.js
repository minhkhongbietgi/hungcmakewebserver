(function(f){var c={updating:true,"toggle-updating":27};f.fn.extend({esp:function(l){f.extend(c,l||{});f("[data-sort-order]").each(g);f("[data-refresh]").each(h);f("div[class~=-esp-flash-inform]").animate({opacity:1},2000).hide("slow");f("[data-modal]").each(function(){f(this).modal({escClose:false,overlayId:"-esp-modal-background",containerId:"-esp-modal-foreground"})})}});f.fn.esp.defaults=c;function b(m){var l=f(this),n=l.is("form")?l.serializeArray():[],o=l.attr("data-remote-method")||l.attr("method")||"GET";if(m===undefined){m=l.attr("data-remote")||l.attr("action")||l.attr("href");if(!m){throw"No URL specified for remote call"}}l.trigger("http:before");f.ajax({url:m,data:n,type:o.toUpperCase(),beforeSend:function(p){l.trigger("http:loading",p)},success:function(s,p,r){l.trigger("http:success",[s,p,r]);var q=l.attr("data-apply");if(q){f(q).html(s)}},complete:function(p){l.trigger("http:complete",p)},error:function(r,p,q){l.trigger("http:failure",[r,p,q])}});l.trigger("http:after")}function j(l){this.each(function(){var m=f(this);f.each(f(l)[0].attributes,function(o,n){if(n.name.indexOf("data-")==0){if(m.attr(n.name)==null){m.attr(n.name,n.value)}}})})}function a(m){var m=f(m);var l={};f.each(m[0].attributes,function(o,n){if(n.name.indexOf("data-")==0){l[n.name.substring(5)]=n.value}});return l}function e(l){if(window.console){console.debug(l)}else{alert(l)}}function d(){var o=f(this);var l=o.attr("data-click-method")||o.attr("data-method")||"GET";var m=o.attr("data-click")||o.attr("action")||o.attr("href");var s=o.attr("data-click-params")||o.attr("data-params");if(m===undefined){alert("No URL specified");return}l=l.toUpperCase();if(l=="GET"){window.location=m}else{var q=f("meta[name=SecurityTokenName]").attr("content");var r=f("meta[name="+q+"]").attr("content");if(r){var n=f('<form method="post" action="'+m+'"/>').append('<input name="-esp-method-" value="'+l+'" type="hidden" />').append('<input name="'+q+'" value="'+r+'" type="hidden" />');if(s){s=s.split("&");var t;for(t in s){var p=s[t];var u=p.split("=");n.append('<input name="'+u[0]+'" value="'+u[1]+'" type="hidden" />')}}n.hide().appendTo("body").submit()}else{alert("Missing Security Token")}}}function g(p){var n=f(this);var r=f.extend({},c,p,n.data("esp-options")||{},a(n));if(!r.sortConfig){if(r.sort!="false"){var m=f("th",n).filter(':contains("'+r.sort+'")');var q=f("th",n).filter(':contains("'+r.sort+'")').get(0);if(q){var l=(r["sort-order"].indexOf("asc")>=0)?0:1;r.sortConfig={sortList:[[q.cellIndex,l]]}}else{r.sortConfig={sortList:[[0,0]]}}}n.tablesorter(r.sortConfig)}n.data("esp-options",r);return this}function h(n){function o(){var t=f(this);var u=t.data("esp-options");var s=u.effects;if(s=="highlight"){t.fadeTo(0,0.5);t.fadeTo(500,1)}else{if(s=="fadein"){t.fadeTo(0,0);t.fadeTo(1000,1)}else{if(s=="fadeout"){t.fadeTo(0,1);t.fadeTo(1000,0)}else{if(s=="bold"){t.css("font-weight",100);t.animate({"font-weight":900},1000)}}}}}function p(x,C){var A,s,y,v;var s=this.attr("id");var D=this.attr("data-apply")||s;var z=(D)?f("#"+D):f(this);var t=z.data("esp-options");var B=C.getResponseHeader("Content-Type")||"text/html";try{if(B=="text/html"){x=f.trim(x);var w=f(x);w.data("esp-options",t);w.attr("id",s);j.call(w,z);if(z[0]&&z[0].tagName=="TABLE"){w.data("tablesorter",z.data("tablesorter"));var u=x[0].config=z[0].config;if(u){w.tablesorter({sortList:u.sortList})}}z.replaceWith(w);z=w}else{A=z[0];if(A.type=="checkbox"){if(x==z.val()){z.attr("checked","yes")}else{z.removeAttr("checked")}}else{if(A.type=="radio"){if(x==z.val()){z.attr("checked","yes")}else{z.removeAttr("checked")}}else{if(A.type=="text"||A.type=="textarea"){z.val(x)}else{if(A.tagName=="IMG"){z.attr("src",x)}else{z.text(x)}}}}}}catch(z){console.debug(z)}o.call(z);return z}function r(t){var s=f(this);var w=s.attr("id");var u=f.extend({},t,s.data("esp-options")||{},a(s));s.data("esp-options",u);if(u.updating){var v=u["refresh-method"]||"GET";f.ajax({url:u.refresh,type:v,success:function(z,x,y){if(y.status==200){s=p.call(s,z,y)}else{if(y.status==0){e("Error updating control: can't connect to server")}else{e("Error updating control: "+y.statusText+" "+y.responseText)}}},complete:function(){setTimeout(function(x){r.call(x,u)},u["refresh-period"],s)},error:function(y,z,x){e("Error updating control: "+z)}})}else{setTimeout(function(x){r.call(x,u)},u["refresh-period"],s)}if(!u.bound){f(document).bind("keyup.refresh",function(x){if(x.keyCode==u["toggle-updating"]){i.call(f("[id="+w+"]"))}});u.bound=true}}var m=f(this);var l=f.extend({},c,n||{});var q=a(m)["refresh-period"];setTimeout(function(s){r.call(s,l)},q,m);return this}function i(){elt=f(this);var l=elt.data("esp-options");if(l){l.updating=!l.updating;elt.data("esp-options",l)}}function k(l){if(l==null||l.keyCode==c["toggle-updating"]){var m=f("[class~=-esp-refresh]");if(m.attr("src")==m.attr("data-off")){m.attr("src",m.attr("data-on"))}else{m.attr("src",m.attr("data-off"))}}}f(document).bind("keyup.refresh",k);f("a[data-confirm],input[data-confirm]").live("click",function(){var l=f(this);l.bind("confirm",function(m){return confirm(l.attr("data-confirm"))});l.trigger("confirm")});f("input[type=submit]").live("click",function(l){f(this).attr("checked",true)});f("a[data-method]:not([data-remote])").live("click",function(l){d.apply(this);l.preventDefault()});f("tr[data-remote]").live("click",function(n){var m=f(this).parents("table");var l=f(this).attr("data-remote");b.call(m,l);n.preventDefault()});f("button[data-remote]").live("click",function(l){b.apply(this);l.preventDefault()});f("form").live("submit",function(l){var m=f(this).attr("data-method");if(m){f(this).append('<input name="-esp-method-" value="'+m+'" type="hidden" />')}});f("form[data-remote]").live("submit",function(l){var m=f(this).attr("data-method");if(m){f(this).append('<input name="-esp-method-" value="'+m+'" type="hidden" />')}b.apply(this);l.preventDefault()});f("a[data-remote],input[data-remote]").live("click",function(l){b.apply(this);l.preventDefault()});f("li[data-toggle]").live("click",function(m){var l=f(this).attr("data-toggle");f("div[id|=pane]").hide();var n=f("div#"+l);n.fadeIn(500);n.addClass("-esp-pane-visible");n.removeClass("-esp-pane-hidden");m.preventDefault();return false});f("[data-click] a").live("click",function(l){d.apply(this);return false});f("[data-click]").live("click",function(l){d.apply(this);l.preventDefault()});f("[data-click]").live("mouseover",function(n){var m=f(this).attr("data-click");if(m.indexOf("http://")==0){window.status=m}else{var l=window.location;window.status=l.protocol+"//"+l.host+m}});f("[data-click]").live("mouseout",function(l){window.status=""});f("[data-remote]").live("mouseover",function(n){var m=f(this).attr("data-remote");if(m.indexOf("http://")==0){window.status=m}else{var l=window.location;window.status=l.protocol+"//"+l.host+m}});f("[data-remote]").live("mouseout",function(l){window.status=""});f("[class~=-esp-refresh]").live("click",function(l){f("[data-refresh]").each(function(){i.call(this)});k();return false});f(document).ready(function(){f(document).esp()})})(jQuery);